{% extends 'anketa/profile.html' %}
{% load staticfiles %}
{% block container %}
<form name="accountForm" action="" class="form-horizontal" role="form" method="post">
	{% csrf_token %}
	<div class="col-md-9 col-xs-10 col-sm-8">
		<div class="row">
			<div class="col-xs-8 col-sm-12 col-md-8">
				<h4>Почта</h4>
				<hr>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-8">
				<label class="col-sm-6 col-md-4 col-xs-3 control-label" for="email">Ваш e-mail</label>
				<div class="col-sm-10 col-md-8 col-xs-10">
					<input type="text" class="form-control" id="email" name="email" value="{{ email }}">
					<span id="icon"></span>
					<span id="descr" class="help-block"></span>
				</div>
			</div>
		</div>
		</br>
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-8">
				<h4>Смена пароля</h4>
				<hr>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-sm-12 col-md-8">
					<label class="col-sm-6 col-md-4 col-xs-3 control-label" for="passwordCurrent">Текущий пароль</label>
					<div class="col-sm-10 col-md-8 col-xs-10">
						<input type="password" class="form-control" id="passwordCurrent" name="passwordCurrent">
						<span id="icon"></span>
						<span id="descr" class="help-block"></span>
					</div>
			</div>
		</div>
		<p>
			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-8">
					<label class="col-sm-6 col-md-4 col-xs-3 control-label" for="passwordNew">Новый пароль</label>
					<div class="col-sm-10 col-md-8 col-xs-10">
						<input type="password" class="form-control" id="passwordNew" name="passwordNew">
						<span id="icon"></span>
						<span id="descr" class="help-block"></span>
					</div>
				</div>
			</div>
		</p>
		<p>
			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-8">
					<label class="col-sm-6 col-md-4 col-xs-3 control-label" for="passwordNewVerify">Повторите пароль</label>
					<div class="col-sm-10 col-md-8 col-xs-10">
						<input type="password" class="form-control" id="passwordNewVerify" name="passwordNewVerify">
						<span id="icon"></span>
						<span id="descr" class="help-block"></span>
					</div>
				</div>
			</div>
		</p>
		</br>
		<div class="row">
			<div class="col-xs-10 col-sm-10 col-md-4 col-md-offset-3">
				<button class="btn btn-primary btn-block" type="button" id="button">Сохранить</button>
			</div>
		</div>
	</div>
</form>
{% endblock %}
{% block scripts %}
<script src="{% static "anketa/js/jquery.bootstrap.wizard.js" %}"></script>
<script src="{% static "anketa/js/prettify.js" %}"></script>
<script src="{% static "anketa/js/bootstrap-typeahead.js" %}"></script>
<script src="{% static "anketa/js/jquery.validate.js" %}"></script>
<script>
var $prevmail = $("#email").val();
$("#email").focusout(function()
{
	var check = $("#email").parent().find("#descr");
	var check1 = $("#email").parent().find('.help-block');
	if ($prevmail == $("#email").val() || $("#email").val().length === 0)
	{
		$("#email").parent().attr("class","has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#email").parent().find("#icon").attr("class", "");
		$("#email").parent().find("#descr").html("");
		return;
	}
	var emailReg = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	if(!emailReg.test($("#email").val()))
	{
		$("#email").parent().attr("class","has-error has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#email").parent().find("#icon").attr("class", "glyphicon glyphicon-remove form-control-feedback");
		$("#email").parent().find("#descr").html("Неверный формат");
		return;
	}
	$.ajax(
	{
		url:"{% url 'authapp:checkEmailValid' %}",
		method:"GET",
		data:{'email':$('#email').val()},
		dataProcess:true,
		timeout:500,
		success:function(data)
		{
			if(parseInt(data['result'])===1)
			{
				$("#email").parent().attr("class","has-error has-feedback col-sm-10 col-md-8 col-xs-10");
				$("#email").parent().find("#icon").attr("class", "glyphicon glyphicon-remove form-control-feedback");
				$("#email").parent().find("#descr").html(data['error_msg']);
			}
			else
			{
				$("#email").parent().attr("class","has-success has-feedback col-sm-10 col-md-8 col-xs-10");
				$("#email").parent().find("#icon").attr("class", "glyphicon glyphicon-ok form-control-feedback");
				$("#email").parent().find("#descr").html("Почта свободна");
			}
		},
		error:function(){
			alert('Check Internet connnection!');
		}
	});
});
$("#passwordNew").focusout(function()
{
	if ($("#passwordNew").val().length === 0)
	{
		$("#passwordNew").parent().attr("class","has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNew").parent().find("#icon").attr("class", "");
		$("#passwordNew").parent().find("#descr").html("");
		return;
	}
	if($("#passwordNew").val().length>=6)
	{
		$("#passwordNew").parent().attr("class","has-success has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNew").parent().find("#icon").attr("class", "glyphicon glyphicon-ok form-control-feedback");
		$("#passwordNew").parent().find("#descr").html("");
	}
	else
	{
		$("#passwordNew").parent().attr("class","has-error has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNew").parent().find("#icon").attr("class", "glyphicon glyphicon-remove form-control-feedback");
		$("#passwordNew").parent().find("#descr").html("Минимальная длина пароля 6 символов");
	}
});
$("#passwordNewVerify").focusout(function()
{
	if ($("#passwordNewVerify").val().length < 6)
	{
		$("#passwordNewVerify").parent().attr("class","has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNewVerify").parent().find("#icon").attr("class", "");
		$("#passwordNewVerify").parent().find("#descr").html("");
		return;
	}
	if($("#passwordNewVerify").val() === $("#passwordNew").val())
	{
		$("#passwordNewVerify").parent().attr("class","has-success has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNewVerify").parent().find("#icon").attr("class", "glyphicon glyphicon-ok form-control-feedback");
		$("#passwordNewVerify").parent().find("#descr").html("");
	}
	else
	{
		$("#passwordNewVerify").parent().attr("class","has-error has-feedback col-sm-10 col-md-8 col-xs-10");
		$("#passwordNewVerify").parent().find("#icon").attr("class", "glyphicon glyphicon-remove form-control-feedback");
		$("#passwordNewVerify").parent().find("#descr").html("Пароли должны совпадать");
	}
});
$("#button").click(function()
{

});
</script>
{% endblock %}