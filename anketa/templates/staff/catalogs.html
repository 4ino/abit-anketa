{% extends 'staff\base.html' %}

{% block head %}
	Справочники
{% endblock %}
{% load staticfiles %}

{% block additionalcss %}
	<link href="{% static 'anketa/select2-3.5.4/select2.css' %}" rel="stylesheet">
	<link href="{% static 'anketa/select2-3.5.4/select2-bootstrap.css' %}" rel="stylesheet">
	<link href="{% static 'anketa/css/prettify.css' %}" rel="stylesheet">
{% endblock %}



{% block scripts %}
	<script src="{% static "anketa/select2-3.5.4/select2.min.js" %}"></script>
	<script src="{% static "anketa/js/prettify.js" %}"></script>
	<script src="{% static "anketa/select2-3.5.4/select2_locale_ru.js" %}"></script>

	<script>
		$(document).ready(function(){
			$('#attribute1').select2({
			placeholder: "Выбрать атрибут",
			language:"ru",
			minimumInputLength: 1,
			ajax:{
				url:"{% url 'staff:get_attrs' %}",
				dataType: 'json',
				delay: 250,
				data:function(params){
				return{
					query: params,
				};
				},
				processResults: function(data, page){
				return {
					results: data,
				};
				},
				cache: true
			}
			});

			$('#attr_add').on('hide.bs.modal',function(event){
			var button = $(event.relatedTarget)
			//var name = $(button).prop('id');
			//if(name === "Save"){
				$('#attr_add_form').submit();
			//}
			});

			$('#attr_detail').on('hide.bs.modal',function(event){
			var button = $(event.relatedTarget)
			//var name = $(button).prop('id');
			//if(name === "Save"){
				$('#attr_details_form').submit();
			//}
			});
			$('#attr_detail').on('loaded.bs.modal',function(event){
			//var button = $(event.relatedTarget)
			//var name = $('#attr_ibute_id').prop('value');
			//	alert(name);
			//if(name === "Save"){
				//$('#attr_details_form').submit();
			//}
			});			
		});	
		
	</script>
{% endblock %}


{% block leftmenu %}
{% endblock %}

{% block content %}

<!-- Modal addtibute detail -->
<div class="modal fade" id="attr_detail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
    	<form action="" method="POST" id="attr_details_form">
      	{% csrf_token %}
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">{{ data.attribute.name }}</h4>
      </div>
      <div class="modal-body">
      		{% csrf_token %}						
			  	<label class="control-label">Тип атрибута:</label>
					<select class="form-control" name="attrtype" id = "attrtype">
						{% for item in data.attrtype %}
							<option value="{{item.id}}">{{ item.name }}</option>
						{% endfor %}      
					</select>				
					<p></p>
					<label class="control-label">Название:</label>
					<input type="text" class="form-control" name = "attr_name" id="attr_name" value ="{{ data.attribute.name }}">
					<p></p>								
	  </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" name="Close">Закрыть</button>
        <button type="submit" class="btn btn-primary" name="save">Сохранить</button>
      </div>
  		</form>
    </div>
  </div>
</div>			


<!-- Modal attribute add-->
<div class="modal fade" id="attr_add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
    	<form action="" method="POST" id="attr_add_form">
      	{% csrf_token %}
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Добавить новый атрибут</h4>
      </div>
      <div class="modal-body">
				<label class="control-label">Тип атрибута:</label>
					<select class="form-control" name="attrtype" id = "attrtype">
						{% for item in data.attrtype %}
						<option value="{{item.id}}">{{ item.name }}</option>
						{% endfor %}      
					</select>
				<p></p>
				<label class="control-label">Название:</label>
				<input type="text" class="form-control" name = "attr_name" id="attr_name" value ="{{ data.attribute.name }}">
				<p></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" name="close">Закрыть</button>
        <button type="submit" class="btn btn-primary" name="save">Сохранить</button>
      </div>
      </form>
    </div>
  </div>
</div>
				
<!--Фильтр по наименованию атрибута-->
		<div class="col-xs-12 col-sm-12 col-md-10 col-md-offset-1">
		<div class="panel panel-default">
			<div class="panel-heading">Список Атрибутов</div>
			<div class="panel-body">
				<form action=""  method="POST">
					{% csrf_token %}  
					<input type = "text" class="form-control" name = "attribute1" id = "attribute1" hidden/>
					<p></p>
					<table>
					<td>
						<button type="submit" class="btn btn-default" name="filter">Применить фильтр</button>
					</td>
					<td>
						<button type="submit" class="btn btn-default" name="reset">Сбросить фильтр</button><!--dasdasdasdasda-->
					</td>
					</table>
				</form>
				<p></p>
				<form action=""  method="POST">
				{% csrf_token %} 
				<table class="table table table-bordered table-hover ">
					<thead> 
							<tr>
								<th width="3%">#</th>
								<th>Имя атрибута</th>
								<th width="2%">v</th>
								<th width="5%">Детали</th>
							</tr>
					</thead>
					<tbody>
							{% for item in data.attribute %}
							<tr>
								<td>{{ forloop.counter }}</td>
								<td><a href="#attr_detail" name="attr_ibute_id" value="{{ item.id }}" data-toggle="modal">{{ item.name }}</a>
								</td>
								<td><input type="checkbox" name="selected" value="{{ item.id }}"></td>
								<td>
								<!--<button type="submit" class="btn btn-info" name="{{item.id}}">>></button-->
								<a href="{% url 'staff:catalogs_attrvalue' item.id %}" class="btn btn-info" role="button" name="{{ item.id }}">>></a>
								</td>
							</tr>
							{% endfor %}
					</tbody>
			</table>
			<!--<button type="submit" class="btn btn-default" name="add">добавить</button>-->
			
			<button type="button" class="btn btn-primary btn-ng" data-toggle="modal" data-target="#attr_add">Добавить</button>
			<button type="submit" class="btn btn-danger" name="delete">Удалить</button>
			</form>					 
			</div>
		</div>       
		</div>

{% endblock %}
